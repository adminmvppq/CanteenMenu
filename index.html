
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Th·ª±c ƒê∆°n Canteen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', sans-serif;
        }
        .logo {
            max-height: 80px;
        }
        .header {
            background-color: #ffffff;
            padding: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .menu-card {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 20px;
        }
        .menu-title {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .meal-section {
            margin-bottom: 10px;
        }
        .meal-section h6 {
            font-weight: bold;
            color: #34495e;
        }
        .search-bar {
            margin-bottom: 20px;
        }
        #loadingOverlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(255,255,255,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            display: none;
        }
        @media (max-width: 576px) {
            .header {
                flex-direction: column !important;
                align-items: flex-start !important;
                text-align: left;
            }
            .header img {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="loadingOverlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div class="container">
        <div class="header d-flex align-items-center justify-content-between flex-wrap">
            <img src="https://adminmvppq.github.io/dataroom-mvppq/img/mvp_pq_logo.png" alt="MVP PQ Logo" class="logo">
            <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center gap-2">
                <h2 class="text-primary m-0">Th·ª±c ƒê∆°n Canteen</h2>
                <select id="langSelect" class="form-select form-select-sm w-auto" onchange="changeLanguage()">
                    <option value="vi">üáªüá≥ Ti·∫øng Vi·ªát</option>
                    <option value="en">üá¨üáß English</option>
                </select>
            </div>
        </div>

        <div class="search-bar row g-2 align-items-end">
            <div class="col-md-4">
                <label for="searchType" class="form-label" data-i18n="searchTypeLabel">Lo·∫°i t√¨m ki·∫øm</label>
                <select id="searchType" class="form-select">
                    <option value="day" data-i18n="searchDay">Theo ng√†y</option>
                    <option value="week" data-i18n="searchWeek">Theo tu·∫ßn</option>
                    <option value="month" data-i18n="searchMonth">Theo th√°ng</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="searchDate" class="form-label" data-i18n="chooseDate">Ch·ªçn ng√†y</label>
                <input type="date" id="searchDate" class="form-control">
            </div>
            <div class="col-md-4">
                <button class="btn btn-primary w-100" onclick="filterMenu()" data-i18n="searchBtn">T√¨m</button>
            </div>
        </div>

        <div id="menuContainer" class="row"></div>
    </div>

    <script>
        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSP9XmNWZdN8-1IgPIO6ouqwHeICx_Sam1EvPmeAsMvHDTKMFVYLna4HD4LHnjEJllC5er7mZ3r8UrV/pub?gid=605327293&single=true&output=csv";
        let currentLang = "vi";

        const i18n = {
            vi: {
                searchTypeLabel: "Lo·∫°i t√¨m ki·∫øm",
                searchDay: "Theo ng√†y",
                searchWeek: "Theo tu·∫ßn",
                searchMonth: "Theo th√°ng",
                chooseDate: "Ch·ªçn ng√†y",
                searchBtn: "T√¨m",
                appetizer: "Khai v·ªã",
                main: "M√≥n ch√≠nh",
                dessert: "Tr√°ng mi·ªáng",
                dayLabel: "Ng√†y"
            },
            en: {
                searchTypeLabel: "Search type",
                searchDay: "By day",
                searchWeek: "By week",
                searchMonth: "By month",
                chooseDate: "Select date",
                searchBtn: "Search",
                appetizer: "Appetizer",
                main: "Main course",
                dessert: "Dessert",
                dayLabel: "Date"
            }
        };

        function showLoading(show) {
            document.getElementById("loadingOverlay").style.display = show ? "flex" : "none";
        }

        function changeLanguage() {
            currentLang = document.getElementById("langSelect").value;
            document.querySelectorAll("[data-i18n]").forEach(el => {
                const key = el.getAttribute("data-i18n");
                el.innerText = i18n[currentLang][key];
            });
        }

        async function fetchMenuData() {
            const response = await fetch(sheetUrl);
            const data = await response.text();
            const rows = data.split("\n").map(row => row.split(","));
            const headers = rows[0];
            const items = rows.slice(1).map(row => {
                let item = {};
                headers.forEach((h, i) => item[h.trim()] = row[i]?.trim());
                return item;
            });
            return items;
        }

        function groupByDate(data) {
            const grouped = {};
            data.forEach(item => {
                const date = item["Ng√†y"];
                if (!grouped[date]) grouped[date] = [];
                grouped[date].push(item);
            });
            return grouped;
        }

        function renderMenu(data) {
            const container = document.getElementById("menuContainer");
            container.innerHTML = "";
            const grouped = groupByDate(data);
            Object.keys(grouped).forEach(date => {
                const dayBlock = document.createElement("div");
                dayBlock.className = "col-12 menu-card";
                dayBlock.innerHTML = `<div class="menu-title">${i18n[currentLang].dayLabel} ${date}</div>`;
                const meals = grouped[date];
                ["S√°ng", "Tr∆∞a", "T·ªëi"].forEach(meal => {
                    const mealItems = meals.filter(m => m["B·ªØa ƒÉn"] === meal);
                    if (mealItems.length > 0) {
                        const section = document.createElement("div");
                        section.className = "meal-section";
                        const icon = meal === "S√°ng" ? "üåÖ" : meal === "Tr∆∞a" ? "üåû" : "üåô";
                        section.innerHTML = `<h6>${icon} ${meal}</h6>`;
                        mealItems.forEach(item => {
                            section.innerHTML += `
                                <div><strong>${i18n[currentLang].appetizer}:</strong> ${item[\`Khai v·ªã (${currentLang})\`] || ""}</div>
                                <div><strong>${i18n[currentLang].main}:</strong> ${item[\`M√≥n ch√≠nh (${currentLang})\`] || ""}</div>
                                <div><strong>${i18n[currentLang].dessert}:</strong> ${item[\`Tr√°ng mi·ªáng (${currentLang})\`] || ""}</div>
                                <hr>
                            `;
                        });
                        dayBlock.appendChild(section);
                    }
                });
                container.appendChild(dayBlock);
            });
        }

        function filterMenu() {
            const type = document.getElementById("searchType").value;
            const date = new Date(document.getElementById("searchDate").value);
            if (!date.getTime()) return;
            showLoading(true);
            fetchMenuData().then(data => {
                let filtered = [];
                data.forEach(item => {
                    const itemDate = new Date(item["Ng√†y"]);
                    if (type === "day" && itemDate.toDateString() === date.toDateString()) {
                        filtered.push(item);
                    } else if (type === "week") {
                        const startOfWeek = new Date(date);
                        startOfWeek.setDate(date.getDate() - date.getDay());
                        const endOfWeek = new Date(startOfWeek);
                        endOfWeek.setDate(startOfWeek.getDate() + 6);
                        if (itemDate >= startOfWeek && itemDate <= endOfWeek) {
                            filtered.push(item);
                        }
                    } else if (type === "month" && itemDate.getMonth() === date.getMonth() && itemDate.getFullYear() === date.getFullYear()) {
                        filtered.push(item);
                    }
                });
                renderMenu(filtered);
                showLoading(false);
            }).catch(() => showLoading(false));
        }

        // Set default language on load
        window.onload = () => {
            changeLanguage();
        };
    </script>
</body>
</html>
