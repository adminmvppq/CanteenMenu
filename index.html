
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Menu Canteen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .logo { max-height: 60px; }
        .header { display: flex; align-items: center; justify-content: space-between; }
        .search-bar { margin: 20px 0; }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .menu-card { border: 1px solid #ccc; border-radius: 8px; padding: 15px; background: #f9f9f9; }
        .menu-card h3 { margin-top: 0; }
        .dropdown { padding: 8px; font-size: 16px; }
        .date-input { padding: 8px; font-size: 16px; margin-left: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://adminmvppq.github.io/dataroom-mvppq/img/mvp_pq_logo.png" alt="Company Logo" class="logo">
        <h1>Thực Đơn Canteen</h1>
    </div>

    <div class="search-bar">
        <label for="searchType">Tìm kiếm:</label>
        <select id="searchType" class="dropdown">
            <option value="day">Theo ngày</option>
            <option value="week">Theo tuần</option>
            <option value="month">Theo tháng</option>
        </select>
        <input type="date" id="searchDate" class="date-input">
        <button onclick="filterMenu()">Tìm</button>
    </div>

    <div id="menuGrid" class="grid-container"></div>

    <script>
        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSP9XmNWZdN8-1IgPIO6ouqwHeICx_Sam1EvPmeAsMvHDTKMFVYLna4HD4LHnjEJllC5er7mZ3r8UrV/pub?gid=1946670694&single=true&output=csv";

        let menuData = [];

        function groupByDate(data) {
            const grouped = {};
            data.forEach(row => {
                const date = row["Ngày"];
                if (!grouped[date]) grouped[date] = [];
                grouped[date].push(row);
            });
            return grouped;
        }

        function renderMenu(data) {
            const container = document.getElementById("menuGrid");
            container.innerHTML = "";
            const grouped = groupByDate(data);
            for (const date in grouped) {
                const card = document.createElement("div");
                card.className = "menu-card";
                card.innerHTML = `<h3>${date}</h3>`;
                grouped[date].forEach(item => {
                    card.innerHTML += `
                        <p><strong>${item["Bữa ăn"]}</strong></p>
                        <ul>
                            <li><strong>Khai vị:</strong> ${item["Khai vị"]}</li>
                            <li><strong>Món chính:</strong> ${item["Món chính"]}</li>
                            <li><strong>Tráng miệng:</strong> ${item["Tráng miệng"]}</li>
                        </ul>
                    `;
                });
                container.appendChild(card);
            }
        }

        function filterMenu() {
            const type = document.getElementById("searchType").value;
            const dateInput = document.getElementById("searchDate").value;
            if (!dateInput) return alert("Vui lòng chọn ngày");

            const selectedDate = new Date(dateInput);
            const filtered = menuData.filter(row => {
                const rowDate = new Date(row["Ngày"]);
                if (type === "day") {
                    return rowDate.toDateString() === selectedDate.toDateString();
                } else if (type === "week") {
                    const startOfWeek = new Date(selectedDate);
                    startOfWeek.setDate(selectedDate.getDate() - selectedDate.getDay());
                    const endOfWeek = new Date(startOfWeek);
                    endOfWeek.setDate(startOfWeek.getDate() + 6);
                    return rowDate >= startOfWeek && rowDate <= endOfWeek;
                } else if (type === "month") {
                    return rowDate.getMonth() === selectedDate.getMonth() &&
                           rowDate.getFullYear() === selectedDate.getFullYear();
                }
                return false;
            });

            renderMenu(filtered);
        }

        function parseCSV(text) {
            const lines = text.trim().split("\n");
            const headers = lines[0].split(",");
            return lines.slice(1).map(line => {
                const values = line.split(",");
                const obj = {};
                headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
                return obj;
            });
        }

        fetch(sheetUrl)
            .then(res => res.text())
            .then(text => {
                menuData = parseCSV(text);
                renderMenu(menuData);
            });
    </script>
</body>
</html>
