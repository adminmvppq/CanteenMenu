<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Th·ª±c ƒê∆°n Canteen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', sans-serif;
        }
        .logo {
            max-height: 80px;
        }
        .header {
            background-color: #ffffff;
            padding: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .menu-card {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 20px;
        }
        .menu-title {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .meal-section {
            margin-bottom: 10px;
        }
        .meal-section h6 {
            font-weight: bold;
            color: #34495e;
        }
        .search-bar {
            margin-bottom: 20px;
        }
        #loadingOverlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(255,255,255,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            display: none;
        }
    </style>
</head>
<body>
    <div id="loadingOverlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div class="container">
        <div class="header d-flex align-items-center justify-content-between">
            <img src="https://adminmvppq.github.io/dataroom-mvppq/img/mvp_pq_logo.png" alt="MVP PQ Logo" class="logo">
            <h2 class="text-primary">Th·ª±c ƒê∆°n Canteen</h2>
        </div>

        <div class="search-bar row g-2 align-items-end">
            <div class="col-md-4">
                <label for="searchType" class="form-label">Lo·∫°i t√¨m ki·∫øm</label>
                <select id="searchType" class="form-select">
                    <option value="day">Theo ng√†y</option>
                    <option value="week">Theo tu·∫ßn</option>
                    <option value="month">Theo th√°ng</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="searchDate" class="form-label">Ch·ªçn ng√†y</label>
                <input type="date" id="searchDate" class="form-control">
            </div>
            <div class="col-md-4">
                <button class="btn btn-primary w-100" onclick="filterMenu()">T√¨m</button>
            </div>
        </div>

        <div id="menuContainer" class="row"></div>
    </div>

    <script>
        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSP9XmNWZdN8-1IgPIO6ouqwHeICx_Sam1EvPmeAsMvHDTKMFVYLna4HD4LHnjEJllC5er7mZ3r8UrV/pub?gid=1946670694&single=true&output=csv";

        function showLoading(show) {
            document.getElementById("loadingOverlay").style.display = show ? "flex" : "none";
        }

        async function fetchMenuData() {
            const response = await fetch(sheetUrl);
            const data = await response.text();
            const rows = data.split("\n").map(row => row.split(","));
            const headers = rows[0];
            const items = rows.slice(1).map(row => {
                let item = {};
                headers.forEach((h, i) => item[h.trim()] = row[i]?.trim());
                return item;
            });
            return items;
        }

        function groupByDate(data) {
            const grouped = {};
            data.forEach(item => {
                const date = item["Ng√†y"];
                if (!grouped[date]) grouped[date] = [];
                grouped[date].push(item);
            });
            return grouped;
        }

        function renderMenu(data) {
            const container = document.getElementById("menuContainer");
            container.innerHTML = "";
            const grouped = groupByDate(data);
            Object.keys(grouped).forEach(date => {
                const dayBlock = document.createElement("div");
                dayBlock.className = "col-12 menu-card";
                dayBlock.innerHTML = `<div class="menu-title">Ng√†y ${date}</div>`;
                const meals = grouped[date];
                ["S√°ng", "Tr∆∞a", "T·ªëi"].forEach(meal => {
                    const mealItems = meals.filter(m => m["B·ªØa ƒÉn"] === meal);
                    if (mealItems.length > 0) {
                        const section = document.createElement("div");
                        section.className = "meal-section";
                        const icon = meal === "S√°ng" ? "üåÖ" : meal === "Tr∆∞a" ? "üåû" : "üåô";
                        section.innerHTML = `<h6>${icon} ${meal}</h6>`;
                        mealItems.forEach(item => {
                            section.innerHTML += `
                                <div><strong>Khai v·ªã:</strong> ${item["Khai v·ªã"]}</div>
                                <div><strong>M√≥n ch√≠nh:</strong> ${item["M√≥n ch√≠nh"]}</div>
                                <div><strong>Tr√°ng mi·ªáng:</strong> ${item["Tr√°ng mi·ªáng"]}</div>
                                <hr>
                            `;
                        });
                        dayBlock.appendChild(section);
                    }
                });
                container.appendChild(dayBlock);
            });
        }

        function filterMenu() {
            const type = document.getElementById("searchType").value;
            const date = new Date(document.getElementById("searchDate").value);
            if (!date.getTime()) return;
            showLoading(true);
            fetchMenuData().then(data => {
                let filtered = [];
                data.forEach(item => {
                    const itemDate = new Date(item["Ng√†y"]);
                    if (type === "day" && itemDate.toDateString() === date.toDateString()) {
                        filtered.push(item);
                    } else if (type === "week") {
                        const startOfWeek = new Date(date);
                        startOfWeek.setDate(date.getDate() - date.getDay());
                        const endOfWeek = new Date(startOfWeek);
                        endOfWeek.setDate(startOfWeek.getDate() + 6);
                        if (itemDate >= startOfWeek && itemDate <= endOfWeek) {
                            filtered.push(item);
                        }
                    } else if (type === "month" && itemDate.getMonth() === date.getMonth() && itemDate.getFullYear() === date.getFullYear()) {
                        filtered.push(item);
                    }
                });
                renderMenu(filtered);
                showLoading(false);
            }).catch(() => showLoading(false));
        }
    </script>
</body>
</html>
